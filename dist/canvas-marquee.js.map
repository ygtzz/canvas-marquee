{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap f62760e9cd2971737a59","webpack:///./src/index.js"],"names":["Marquee","opts","canvas","document","getElementById","id","rect","getBoundingClientRect","w","right","left","h","bottom","top","ctx","getContext","font","lastLeft","gap","data","marqueeList","lastWidth","index","value","color","offset","width","Math","ceil","measureText","marquee","getLeft","push","length","clearRect","i","b","splice","fAddLastNode","drawText","getLastLeft","forEach","t","shoot","requestAnimationFrame","draw","bind","fillStyle","fillText","last","start","res","isNumber","obj"],"mappings":"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","file":"canvas-marquee.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f62760e9cd2971737a59","//TODO：\r\n//1. 支持纵向文字滚动\r\n//2. 支持多行文字滚动\r\nclass Marquee {\r\n    constructor(opts) {\r\n        this.opts = opts;\r\n        this.canvas = document.getElementById(opts.id);\r\n        let rect = this.canvas.getBoundingClientRect();\r\n        this.w = rect.right - rect.left;\r\n        this.h = rect.bottom - rect.top;\r\n        this.ctx = this.canvas.getContext('2d');\r\n        this.ctx.font = opts.font;\r\n        this.lastLeft = this.w;\r\n        this.gap = opts.gap;\r\n        this.data = opts.data;\r\n        this.marqueeList = [];\r\n        this.lastWidth = 0;\r\n        this.index = 0;\r\n    }\r\n    //添加弹幕列表\r\n    shoot(value) {\r\n        let top = this.opts.top;\r\n        let color = this.opts.color;\r\n        let offset = this.opts.offset || 1;\r\n        let width = Math.ceil(this.ctx.measureText(value).width);\r\n\r\n        let marquee = {\r\n            value: value,\r\n            top: top,\r\n            left: this.getLeft(width),\r\n            color: color,\r\n            offset: offset,\r\n            width: width\r\n        }\r\n        this.marqueeList.push(marquee);\r\n        return marquee;\r\n    }\r\n    //开始绘制\r\n    draw() {\r\n        if (this.marqueeList.length) {\r\n            this.ctx.clearRect(0, 0, this.w, this.h);\r\n            for (let i = 0; i < this.marqueeList.length; i++) {\r\n                let b = this.marqueeList[i];\r\n                if (b.left + b.width <= 0) {\r\n                    this.marqueeList.splice(i, 1);\r\n                    i--;\r\n                    this.fAddLastNode(b);\r\n                    continue;\r\n                }\r\n                b.left -= b.offset;\r\n                this.drawText(b);\r\n            }\r\n        }\r\n        else{\r\n            this.lastLeft = this.getLastLeft();\r\n            this.data.forEach((t) => {\r\n                this.shoot(t);\r\n            })\r\n        }\r\n        requestAnimationFrame(this.draw.bind(this));\r\n    }\r\n    //绘制文字\r\n    drawText(marquee) {\r\n        this.ctx.fillStyle = marquee.color;\r\n        this.ctx.fillText(marquee.value, marquee.left, marquee.top);\r\n    }\r\n    fAddLastNode(b){\r\n        var last = this.marqueeList[this.marqueeList.length-1];\r\n        b.left = last.left + last.width + this.gap;\r\n        this.marqueeList.push(b);\r\n    }\r\n    getLeft(width){\r\n        this.lastLeft += this.lastWidth + this.gap;\r\n        this.lastWidth = width;\r\n        return this.lastLeft;\r\n    }\r\n    getLastLeft(){\r\n        let {start} = this.opts;\r\n        //default is left\r\n        let res = 0;\r\n        if(start == 'right'){\r\n            res = this.w;\r\n        }\r\n        else if(isNumber(start)){\r\n            res = start;\r\n        }\r\n        return res;\r\n    }\r\n}\r\n\r\n\r\nfunction isNumber(obj) {  \r\n    return obj === +obj  \r\n}\r\n\r\nexport {Marquee};\r\nexport default Marquee;\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}